# List all available commands
default:
    @just --list

# Run the application
run *ARGS:
    go run ./cmd/myapp {{ARGS}}

# Build the binary
build:
    go build -o bin/myapp ./cmd/myapp

# Build for production (with optimizations)
build-prod:
    CGO_ENABLED=0 go build -ldflags="-s -w" -o bin/myapp ./cmd/myapp

# Run all tests
test:
    go test -v ./...

# Run tests with coverage
test-coverage:
    go test -v -race -coverprofile=coverage.out ./...
    go tool cover -html=coverage.out -o coverage.html

# Run tests with race detector
test-race:
    go test -race ./...

# Format code
fmt:
    go fmt ./...

# Run go vet
vet:
    go vet ./...

# Run linter (requires golangci-lint)
lint:
    golangci-lint run

# Run all checks (fmt, vet, lint, test)
check: fmt vet lint test

# Tidy dependencies
tidy:
    go mod tidy
    go mod verify

# Update dependencies
update:
    go get -u ./...
    go mod tidy

# Download dependencies
deps:
    go mod download

# Clean build artifacts
clean:
    rm -rf bin/
    rm -f coverage.out coverage.html

# Generate code (if using go generate)
generate:
    go generate ./...

# Install development tools
install-tools:
    go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# Run the app with live reload (requires air)
dev:
    air

# Docker build
docker-build:
    docker build -t myapp:latest .

# Show dependencies tree
deps-tree:
    go mod graph

# Security audit
audit:
    go list -json -deps ./... | nancy sleuth